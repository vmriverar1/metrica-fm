"use strict";(()=>{var e={};e.id=5592,e.ids=[5592],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63655:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>x,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>v});var s={};r.r(s),r.d(s,{DELETE:()=>_,GET:()=>c,OPTIONS:()=>y,PUT:()=>g});var a=r(96559),o=r(48088),i=r(37719),n=r(32190),d=r(66321),u=r(70818),l=r(31075);let p="dynamic-content/careers/content.json",c=(0,d.ru)(async(e,t,{params:r})=>{try{let{id:e}=r,t=await u.Yy.readJSON(p,!0),s=t.job_postings||[],a=t.departments||[],o=s.find(t=>t.id===e);if(!o)return n.NextResponse.json({success:!1,error:"JOB_NOT_FOUND",message:"Job not found."},{status:404});let i=a.find(e=>e.id===o.category),d={...o,department_info:i?{id:i.id,name:i.name,slug:i.slug,color:i.color,icon:i.icon,open_positions:i.open_positions,description:i.description,required_skills:i.required_skills,career_path:i.career_path}:null,days_until_deadline:o.deadline?Math.ceil((new Date(o.deadline).getTime()-new Date().getTime())/864e5):null,days_since_posted:o.posted_date?Math.floor((new Date().getTime()-new Date(o.posted_date).getTime())/864e5):null},l=s.filter(t=>t.category===o.category&&t.id!==e&&"active"===t.status).slice(0,5).map(e=>({id:e.id,title:e.title,slug:e.slug,level:e.level,type:e.type,location:e.location,featured:e.featured,urgent:e.urgent,posted_date:e.posted_date,deadline:e.deadline,applicant_count:e.applicant_count})),c=i?{total_jobs:s.filter(e=>e.category===o.category).length,active_jobs:s.filter(e=>e.category===o.category&&"active"===e.status).length,average_applications:Math.round(s.filter(e=>e.category===o.category).reduce((e,t)=>e+(t.applicant_count||0),0)/s.filter(e=>e.category===o.category).length||1)}:null;return n.NextResponse.json({success:!0,data:{job:d,related_jobs:l,department:i||null,department_stats:c}})}catch(e){return await l.vF.error("careers-api",`Failed to get job: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to retrieve job."},{status:500})}},(0,d.PS)("careers","read")()),g=(0,d.ru)(async(e,t,{params:r})=>{try{let{id:s}=r,{title:a,slug:o,category:i,department:d,location:c,type:g,level:_,status:y,experience_years:m,featured:f,urgent:v,posted_date:x,deadline:h,short_description:j,full_description:b,key_responsibilities:w,requirements:N,salary:R,application_process:T,questions:A,tags:O,hiring_manager:I,seo:E,metadata:S}=await e.json();if(!a||!i||!d||!c||!j)return n.NextResponse.json({success:!1,error:"INVALID_INPUT",message:"Title, category, department, location and short_description are required."},{status:400});let q=await u.Yy.readJSON(p,!0),k=q.job_postings||[],P=q.departments||[],D=k.findIndex(e=>e.id===s);if(-1===D)return n.NextResponse.json({success:!1,error:"JOB_NOT_FOUND",message:"Job not found."},{status:404});let F=k[D];if(!P.find(e=>e.id===i))return n.NextResponse.json({success:!1,error:"INVALID_DEPARTMENT",message:"The specified department does not exist."},{status:400});if(o&&o!==F.slug&&k.find(e=>e.slug===o&&e.id!==s))return n.NextResponse.json({success:!1,error:"SLUG_EXISTS",message:"A job with this slug already exists."},{status:409});let J={...F,title:a,slug:o||F.slug,category:i,department:d,location:{city:c?.city!==void 0?c.city:F.location?.city||"",region:c?.region!==void 0?c.region:F.location?.region||"",country:c?.country!==void 0?c.country:F.location?.country||"Per\xfa",remote:c?.remote!==void 0?!!c.remote:!!F.location?.remote,hybrid:c?.hybrid!==void 0?!!c.hybrid:!!F.location?.hybrid,address:c?.address!==void 0?c.address:F.location?.address||""},type:void 0!==g?g:F.type,level:void 0!==_?_:F.level,status:void 0!==y?y:F.status,experience_years:void 0!==m?Number(m):F.experience_years,featured:void 0!==f?!!f:F.featured,urgent:void 0!==v?!!v:F.urgent,posted_date:void 0!==x?x:F.posted_date,deadline:void 0!==h?h:F.deadline,short_description:j,full_description:void 0!==b?b:F.full_description,key_responsibilities:void 0!==w?Array.isArray(w)?w:[]:F.key_responsibilities,requirements:void 0!==N?{essential:Array.isArray(N.essential)?N.essential:[],preferred:Array.isArray(N.preferred)?N.preferred:[]}:F.requirements,salary:void 0!==R?R:F.salary,application_process:void 0!==T?T:F.application_process,questions:void 0!==A?Array.isArray(A)?A:[]:F.questions,tags:void 0!==O?Array.isArray(O)?O:[]:F.tags,hiring_manager:void 0!==I?I:F.hiring_manager,seo:void 0!==E?{meta_title:E.meta_title||`${a} | Carreras M\xe9trica DIP`,meta_description:E.meta_description||j,keywords:Array.isArray(E.keywords)?E.keywords:[]}:F.seo,metadata:{...F.metadata,...S||{},updated_at:new Date().toISOString(),updated_by:t.user.id}};k[D]=J;let M=F.category,U=F.status,L=y||F.status;if(M!==i||U!==L){if("active"===U){let e=P.findIndex(e=>e.id===M);-1!==e&&(P[e].open_positions=Math.max(0,(P[e].open_positions||1)-1))}if("active"===L){let e=P.findIndex(e=>e.id===i);-1!==e&&(P[e].open_positions=(P[e].open_positions||0)+1)}}let C={...q,job_postings:k,departments:P,page_info:{...q.page_info,hero:{...q.page_info.hero,stats:{...q.page_info.hero.stats,total_positions:k.filter(e=>"active"===e.status).length}}},metadata:{...q.metadata,total_open_positions:k.filter(e=>"active"===e.status).length,last_updated:new Date().toISOString()}};return await u.Yy.writeJSON(p,C,{validate:!0,backup:!0}),await l.vF.audit({action:"update",resource:"career-job",resourceId:s,message:`Career job '${a}' updated`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{title:a,slug:J.slug,category:i,department:d,level:_,type:g,status:y,category_changed:M!==i,status_changed:U!==L}}),n.NextResponse.json({success:!0,message:"Job updated successfully.",data:{job:J}})}catch(e){return await l.vF.error("careers-api",`Failed to update job: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to update job."},{status:500})}},(0,d.PS)("careers","write")()),_=(0,d.ru)(async(e,t,{params:r})=>{try{let{id:s}=r,a=await u.Yy.readJSON(p,!0),o=a.job_postings||[],i=a.departments||[],d=o.findIndex(e=>e.id===s);if(-1===d)return n.NextResponse.json({success:!1,error:"JOB_NOT_FOUND",message:"Job not found."},{status:404});let c=o[d];if(o.splice(d,1),"active"===c.status){let e=i.findIndex(e=>e.id===c.category);-1!==e&&(i[e].open_positions=Math.max(0,(i[e].open_positions||1)-1))}let g={...a,job_postings:o,departments:i,page_info:{...a.page_info,hero:{...a.page_info.hero,stats:{...a.page_info.hero.stats,total_positions:o.filter(e=>"active"===e.status).length}}},metadata:{...a.metadata,total_open_positions:o.filter(e=>"active"===e.status).length,last_updated:new Date().toISOString()}};return await u.Yy.writeJSON(p,g,{validate:!0,backup:!0}),await l.vF.audit({action:"delete",resource:"career-job",resourceId:s,message:`Career job '${c.title}' deleted`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{title:c.title,slug:c.slug,category:c.category,department:c.department,level:c.level,type:c.type}}),n.NextResponse.json({success:!0,message:"Job deleted successfully."})}catch(e){return await l.vF.error("careers-api",`Failed to delete job: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to delete job."},{status:500})}},(0,d.PS)("careers","delete")());async function y(){return new n.NextResponse(null,{status:200,headers:{Allow:"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Methods":"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let m=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/admin/careers/jobs/[id]/route",pathname:"/api/admin/careers/jobs/[id]",filename:"route",bundlePath:"app/api/admin/careers/jobs/[id]/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/admin/careers/jobs/[id]/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:v,serverHooks:x}=m;function h(){return(0,i.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:v})}},79428:e=>{e.exports=require("buffer")},79748:e=>{e.exports=require("fs/promises")},94735:e=>{e.exports=require("events")}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,3205,4659,1220,6321,818],()=>r(63655));module.exports=s})();