"use strict";(()=>{var e={};e.id=1646,e.ids=[1646],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73616:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>S,routeModule:()=>h,serverHooks:()=>y,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{GET:()=>m,OPTIONS:()=>_,POST:()=>w});var s=r(96559),i=r(48088),o=r(37719),n=r(32190),d=r(66321),u=r(70818),l=r(31075),c=r(55511),p=r.n(c);let g="dynamic-content/newsletter/content.json",m=(0,d.ru)(async(e,t)=>{try{let{searchParams:t}=new URL(e.url),r="true"===t.get("include_stats"),a=t.get("search"),s=t.get("featured"),i=await u.Yy.readJSON(g,!0),o=i.categories||[],d=i.articles||[];if(a){let e=a.toLowerCase();o=o.filter(t=>t.name?.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e))}if(null!=s){let e="true"===s;o=o.filter(t=>!!t.featured===e)}o.sort((e,t)=>(e.order||999)-(t.order||999));let l=o.map(e=>{let t=d.filter(t=>t.category===e.id),a=t.filter(e=>e.published_date),s={...e,articles_count:t.length,published_articles_count:a.length};if(r){let e=t.reduce((e,t)=>e+(t.reading_time||0),0);return{...s,stats:{total_reading_time:e,average_reading_time:t.length>0?Math.round(e/t.length):0,featured_articles:t.filter(e=>e.featured).length,draft_articles:t.filter(e=>!e.published_date).length,latest_article_date:a.length>0?a.sort((e,t)=>new Date(t.published_date).getTime()-new Date(e.published_date).getTime())[0].published_date:null},recent_articles:a.sort((e,t)=>new Date(t.published_date).getTime()-new Date(e.published_date).getTime()).slice(0,3).map(e=>({id:e.id,title:e.title,slug:e.slug,published_date:e.published_date,reading_time:e.reading_time,featured:e.featured}))}}return s});return n.NextResponse.json({success:!0,data:{categories:l,summary:{total_categories:o.length,featured_categories:o.filter(e=>e.featured).length,total_articles:o.reduce((e,t)=>e+(t.articles_count||0),0)}}})}catch(e){return await l.vF.error("newsletter-api","Failed to list categories",e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to retrieve categories."},{status:500})}},(0,d.PS)("newsletter","read")()),w=(0,d.ru)(async(e,t)=>{try{let{name:r,slug:a,description:s,color:i="#6B7280",icon:o="FileText",featured:d=!1,order:c}=await e.json();if(!r||!s)return n.NextResponse.json({success:!1,error:"INVALID_INPUT",message:"Name and description are required."},{status:400});let m=await u.Yy.readJSON(g,!0),w=m.categories||[],_=a||r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(w.some(e=>e.slug===_))return n.NextResponse.json({success:!1,error:"SLUG_EXISTS",message:"A category with this slug already exists."},{status:409});let h=void 0!==c?c:Math.max(...w.map(e=>e.order||0),0)+1,f={id:`cat-${p().randomBytes(6).toString("hex")}`,name:r,slug:_,description:s,color:i,icon:o,articles_count:0,featured:!!d,order:h,created_at:new Date().toISOString(),created_by:t.user.id,updated_at:new Date().toISOString(),updated_by:t.user.id};w.push(f);let x={...m,categories:w,metadata:{...m.metadata,total_categories:w.length,featured_categories:w.filter(e=>e.featured).length,last_updated:new Date().toISOString()}};return await u.Yy.writeJSON(g,x,{validate:!0,backup:!0}),await l.vF.audit({action:"create",resource:"newsletter-category",resourceId:f.id,message:`Newsletter category '${r}' created`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{name:r,slug:_,featured:d}}),n.NextResponse.json({success:!0,message:"Category created successfully.",data:{category:f}},{status:201})}catch(e){return await l.vF.error("newsletter-api","Failed to create category",e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to create category."},{status:500})}},(0,d.PS)("newsletter","write")());async function _(){return new n.NextResponse(null,{status:200,headers:{Allow:"GET, POST, OPTIONS","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let h=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/newsletter/categories/route",pathname:"/api/admin/newsletter/categories",filename:"route",bundlePath:"app/api/admin/newsletter/categories/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/admin/newsletter/categories/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:f,workUnitAsyncStorage:x,serverHooks:y}=h;function S(){return(0,o.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:x})}},79428:e=>{e.exports=require("buffer")},79748:e=>{e.exports=require("fs/promises")},94735:e=>{e.exports=require("events")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,3205,4659,1220,6321,818],()=>r(73616));module.exports=a})();