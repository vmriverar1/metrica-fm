"use strict";(()=>{var e={};e.id=7983,e.ids=[7983],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{e.exports=require("buffer")},79748:e=>{e.exports=require("fs/promises")},88971:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>f,serverHooks:()=>w,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>x});var a={};r.r(a),r.d(a,{DELETE:()=>_,GET:()=>p,OPTIONS:()=>m,PUT:()=>g});var s=r(96559),i=r(48088),d=r(37719),n=r(32190),o=r(66321),l=r(70818),u=r(31075);let c="dynamic-content/newsletter/content.json",p=(0,o.ru)(async(e,t,{params:r})=>{try{let{id:e}=r,t=await l.Yy.readJSON(c,!0),a=t.articles||[],s=t.authors||[],i=t.categories||[],d=a.find(t=>t.id===e);if(!d)return n.NextResponse.json({success:!1,error:"ARTICLE_NOT_FOUND",message:"Article not found."},{status:404});let o=s.find(e=>e.id===d.author_id),u=i.find(e=>e.id===d.category),p={...d,author_info:o?{id:o.id,name:o.name,role:o.role,avatar:o.avatar,bio:o.bio,linkedin:o.linkedin,email:o.email,specializations:o.specializations}:null,category_info:u?{id:u.id,name:u.name,slug:u.slug,color:u.color,icon:u.icon,description:u.description}:null,days_since_published:d.published_date?Math.floor((new Date().getTime()-new Date(d.published_date).getTime())/864e5):null,status:d.published_date?"published":"draft"},g=a.filter(t=>t.author_id===d.author_id&&t.id!==e&&t.published_date).slice(0,3),_=a.filter(t=>t.category===d.category&&t.id!==e&&t.published_date).slice(0,3),m=[...g,..._.filter(e=>!g.find(t=>t.id===e.id))].slice(0,5).map(e=>({id:e.id,title:e.title,slug:e.slug,excerpt:e.excerpt,featured_image:e.featured_image,published_date:e.published_date,reading_time:e.reading_time,author_name:s.find(t=>t.id===e.author_id)?.name||"Unknown",category_name:i.find(t=>t.id===e.category)?.name||"Unknown"}));return n.NextResponse.json({success:!0,data:{article:p,related_articles:m,author:o||null,category:u||null}})}catch(e){return await u.vF.error("newsletter-api",`Failed to get article: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to retrieve article."},{status:500})}},(0,o.PS)("newsletter","read")()),g=(0,o.ru)(async(e,t,{params:r})=>{try{let{id:a}=r,{title:s,slug:i,category:d,author_id:o,featured_image:p,featured_image_alt:g,excerpt:_,content:m,published_date:f,reading_time:h,featured:x,tags:w,seo_description:y,social_image:N,related_articles:R,gallery:v}=await e.json();if(!s||!d||!o||!_||!m)return n.NextResponse.json({success:!1,error:"INVALID_INPUT",message:"Title, category, author_id, excerpt and content are required."},{status:400});let A=await l.Yy.readJSON(c,!0),I=A.articles||[],T=A.authors||[],O=A.categories||[],E=I.findIndex(e=>e.id===a);if(-1===E)return n.NextResponse.json({success:!1,error:"ARTICLE_NOT_FOUND",message:"Article not found."},{status:404});let S=I[E];if(!T.find(e=>e.id===o))return n.NextResponse.json({success:!1,error:"INVALID_AUTHOR",message:"The specified author does not exist."},{status:400});if(!O.find(e=>e.id===d))return n.NextResponse.json({success:!1,error:"INVALID_CATEGORY",message:"The specified category does not exist."},{status:400});if(i&&i!==S.slug&&I.find(e=>e.slug===i&&e.id!==a))return n.NextResponse.json({success:!1,error:"SLUG_EXISTS",message:"An article with this slug already exists."},{status:409});let j=h||(m!==S.content?Math.ceil(m.length/1e3*4):S.reading_time),b={...S,title:s,slug:i||S.slug,category:d,author_id:o,featured_image:void 0!==p?p:S.featured_image,featured_image_alt:void 0!==g?g:S.featured_image_alt,excerpt:_,content:m,published_date:void 0!==f?f:S.published_date,reading_time:j,featured:void 0!==x?!!x:S.featured,tags:void 0!==w?Array.isArray(w)?w:[]:S.tags,seo_description:void 0!==y?y:S.seo_description,social_image:void 0!==N?N:S.social_image,url:`/blog/${i||S.slug}`,related_articles:void 0!==R?Array.isArray(R)?R:[]:S.related_articles,gallery:void 0!==v?Array.isArray(v)?v:[]:S.gallery,updated_at:new Date().toISOString(),updated_by:t.user.id};if(I[E]=b,S.author_id!==o){let e=T.findIndex(e=>e.id===S.author_id);-1!==e&&(T[e].articles_count=Math.max(0,(T[e].articles_count||1)-1));let t=T.findIndex(e=>e.id===o);-1!==t&&(T[t].articles_count=(T[t].articles_count||0)+1)}if(S.category!==d){let e=O.findIndex(e=>e.id===S.category);-1!==e&&(O[e].articles_count=Math.max(0,(O[e].articles_count||1)-1));let t=O.findIndex(e=>e.id===d);-1!==t&&(O[t].articles_count=(O[t].articles_count||0)+1)}let k={...A,articles:I,authors:T,categories:O,metadata:{...A.metadata,total_articles:I.length,featured_articles:I.filter(e=>e.featured).length,total_reading_time:I.reduce((e,t)=>e+(t.reading_time||0),0),average_reading_time:Math.round(I.reduce((e,t)=>e+(t.reading_time||0),0)/I.length),last_updated:new Date().toISOString()}};return await l.Yy.writeJSON(c,k,{validate:!0,backup:!0}),await u.vF.audit({action:"update",resource:"newsletter-article",resourceId:a,message:`Newsletter article '${s}' updated`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{title:s,slug:b.slug,category:d,author_id:o,featured:x,author_changed:S.author_id!==o,category_changed:S.category!==d}}),n.NextResponse.json({success:!0,message:"Article updated successfully.",data:{article:b}})}catch(e){return await u.vF.error("newsletter-api",`Failed to update article: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to update article."},{status:500})}},(0,o.PS)("newsletter","write")()),_=(0,o.ru)(async(e,t,{params:r})=>{try{let{id:a}=r,s=await l.Yy.readJSON(c,!0),i=s.articles||[],d=s.authors||[],o=s.categories||[],p=i.findIndex(e=>e.id===a);if(-1===p)return n.NextResponse.json({success:!1,error:"ARTICLE_NOT_FOUND",message:"Article not found."},{status:404});let g=i[p];i.splice(p,1);let _=d.findIndex(e=>e.id===g.author_id);-1!==_&&(d[_].articles_count=Math.max(0,(d[_].articles_count||1)-1));let m=o.findIndex(e=>e.id===g.category);-1!==m&&(o[m].articles_count=Math.max(0,(o[m].articles_count||1)-1));let f={...s,articles:i,authors:d,categories:o,metadata:{...s.metadata,total_articles:i.length,featured_articles:i.filter(e=>e.featured).length,total_reading_time:i.reduce((e,t)=>e+(t.reading_time||0),0),average_reading_time:i.length>0?Math.round(i.reduce((e,t)=>e+(t.reading_time||0),0)/i.length):0,last_updated:new Date().toISOString()}};return await l.Yy.writeJSON(c,f,{validate:!0,backup:!0}),await u.vF.audit({action:"delete",resource:"newsletter-article",resourceId:a,message:`Newsletter article '${g.title}' deleted`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{title:g.title,slug:g.slug,category:g.category,author_id:g.author_id}}),n.NextResponse.json({success:!0,message:"Article deleted successfully."})}catch(e){return await u.vF.error("newsletter-api",`Failed to delete article: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to delete article."},{status:500})}},(0,o.PS)("newsletter","delete")());async function m(){return new n.NextResponse(null,{status:200,headers:{Allow:"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Methods":"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let f=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/newsletter/articles/[id]/route",pathname:"/api/admin/newsletter/articles/[id]",filename:"route",bundlePath:"app/api/admin/newsletter/articles/[id]/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/admin/newsletter/articles/[id]/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:h,workUnitAsyncStorage:x,serverHooks:w}=f;function y(){return(0,d.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:x})}},94735:e=>{e.exports=require("events")}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,3205,4659,1220,6321,818],()=>r(88971));module.exports=a})();