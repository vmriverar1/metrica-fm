"use strict";(()=>{var e={};e.id=7987,e.ids=[7987],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77586:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>b,routeModule:()=>f,serverHooks:()=>x,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>h,OPTIONS:()=>_,POST:()=>m});var s=r(96559),i=r(48088),o=r(37719),d=r(32190),l=r(66321),n=r(70818),u=r(31075),c=r(55511),g=r.n(c);let p="dynamic-content/newsletter/content.json",h=(0,l.ru)(async(e,t)=>{try{let{searchParams:t}=new URL(e.url),r={page:t.get("page")?parseInt(t.get("page")):1,limit:t.get("limit")?parseInt(t.get("limit")):20,sort:t.get("sort")||"published_date",order:t.get("order")||"desc",search:t.get("search")||void 0,category:t.get("category")||void 0,author_id:t.get("author_id")||void 0,featured:t.get("featured")||void 0,published:t.get("published")||void 0,tags:t.get("tags")||void 0},a=await n.Yy.readJSON(p,!0),s=a.articles||[],i=a.authors||[],o=a.categories||[];if(r.search){let e=r.search.toLowerCase();s=s.filter(t=>t.title?.toLowerCase().includes(e)||t.excerpt?.toLowerCase().includes(e)||t.content?.toLowerCase().includes(e)||t.tags?.some(t=>t.toLowerCase().includes(e)))}if(r.category&&(s=s.filter(e=>e.category===r.category)),r.author_id&&(s=s.filter(e=>e.author_id===r.author_id)),void 0!==r.featured){let e="true"===r.featured;s=s.filter(t=>!!t.featured===e)}if(void 0!==r.published){let e="true"===r.published;s=s.filter(t=>e?!!t.published_date:!t.published_date)}if(r.tags){let e=r.tags.split(",").map(e=>e.trim().toLowerCase());s=s.filter(t=>t.tags?.some(t=>e.includes(t.toLowerCase())))}s.sort((e,t)=>{let a=e[r.sort],s=t[r.sort];if("published_date"===r.sort&&(a=new Date(a||0).getTime(),s=new Date(s||0).getTime()),"number"==typeof a&&"number"==typeof s)return"desc"===r.order?s-a:a-s;let i=String(a||"").localeCompare(String(s||""));return"desc"===r.order?-i:i});let l=s.length,u=Math.ceil(l/r.limit),c=(r.page-1)*r.limit,g=s.slice(c,c+r.limit).map(e=>{let t=i.find(t=>t.id===e.author_id),r=o.find(t=>t.id===e.category);return{...e,author_info:t?{id:t.id,name:t.name,role:t.role,avatar:t.avatar,bio:t.bio}:null,category_info:r?{id:r.id,name:r.name,slug:r.slug,color:r.color,icon:r.icon}:null,days_since_published:e.published_date?Math.floor((new Date().getTime()-new Date(e.published_date).getTime())/864e5):null,status:e.published_date?"published":"draft"}}),h={total_articles:l,published_articles:s.filter(e=>e.published_date).length,draft_articles:s.filter(e=>!e.published_date).length,featured_articles:s.filter(e=>e.featured).length,by_category:o.map(e=>({category:e.name,count:s.filter(t=>t.category===e.id).length})),by_author:i.map(e=>({author:e.name,count:s.filter(t=>t.author_id===e.id).length})),total_reading_time:s.reduce((e,t)=>e+(t.reading_time||0),0),average_reading_time:Math.round(s.reduce((e,t)=>e+(t.reading_time||0),0)/(s.length||1))};return d.NextResponse.json({success:!0,data:{articles:g,pagination:{page:r.page,limit:r.limit,total:l,totalPages:u,hasNextPage:r.page<u,hasPrevPage:r.page>1},filters:{search:r.search,category:r.category,author_id:r.author_id,featured:r.featured,published:r.published,tags:r.tags,sort:r.sort,order:r.order},authors:i.map(e=>({id:e.id,name:e.name,role:e.role,articles_count:s.filter(t=>t.author_id===e.id).length})),categories:o.map(e=>({id:e.id,name:e.name,slug:e.slug,articles_count:s.filter(t=>t.category===e.id).length})),stats:h}})}catch(e){return await u.vF.error("newsletter-api","Failed to list articles",e,{userId:t.user.id}),d.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to retrieve articles."},{status:500})}},(0,l.PS)("newsletter","read")()),m=(0,l.ru)(async(e,t)=>{try{let{title:r,slug:a,category:s,author_id:i,featured_image:o,featured_image_alt:l,excerpt:c,content:h,published_date:m,reading_time:_,featured:f=!1,tags:w=[],seo_description:y,social_image:x,related_articles:b=[],gallery:v=[]}=await e.json();if(!r||!s||!i||!c||!h)return d.NextResponse.json({success:!1,error:"INVALID_INPUT",message:"Title, category, author_id, excerpt and content are required."},{status:400});let A=await n.Yy.readJSON(p,!0),N=A.articles||[],S=A.authors||[],R=A.categories||[];if(!S.find(e=>e.id===i))return d.NextResponse.json({success:!1,error:"INVALID_AUTHOR",message:"The specified author does not exist."},{status:400});if(!R.find(e=>e.id===s))return d.NextResponse.json({success:!1,error:"INVALID_CATEGORY",message:"The specified category does not exist."},{status:400});let T=a||r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(N.some(e=>e.slug===T))return d.NextResponse.json({success:!1,error:"SLUG_EXISTS",message:"An article with this slug already exists."},{status:409});let I=_||Math.ceil(h.length/1e3*4),O={id:`article-${g().randomBytes(6).toString("hex")}`,title:r,slug:T,category:s,author_id:i,featured_image:o||"",featured_image_alt:l||"",excerpt:c,content:h,published_date:m||null,reading_time:I,featured:!!f,tags:Array.isArray(w)?w:[],seo_description:y||c,social_image:x||o||"",url:`/blog/${T}`,related_articles:Array.isArray(b)?b:[],gallery:Array.isArray(v)?v:[],created_at:new Date().toISOString(),created_by:t.user.id,updated_at:new Date().toISOString(),updated_by:t.user.id};N.push(O);let P=S.findIndex(e=>e.id===i);-1!==P&&(S[P].articles_count=(S[P].articles_count||0)+1);let j=R.findIndex(e=>e.id===s);-1!==j&&(R[j].articles_count=(R[j].articles_count||0)+1);let C={...A,articles:N,authors:S,categories:R,metadata:{...A.metadata,total_articles:N.length,featured_articles:N.filter(e=>e.featured).length,total_reading_time:N.reduce((e,t)=>e+(t.reading_time||0),0),average_reading_time:Math.round(N.reduce((e,t)=>e+(t.reading_time||0),0)/N.length),last_updated:new Date().toISOString()}};return await n.Yy.writeJSON(p,C,{validate:!0,backup:!0}),await u.vF.audit({action:"create",resource:"newsletter-article",resourceId:O.id,message:`Newsletter article '${r}' created`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{title:r,slug:T,category:s,author_id:i,featured:f}}),d.NextResponse.json({success:!0,message:"Article created successfully.",data:{article:O}},{status:201})}catch(e){return await u.vF.error("newsletter-api","Failed to create article",e,{userId:t.user.id}),d.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to create article."},{status:500})}},(0,l.PS)("newsletter","write")());async function _(){return new d.NextResponse(null,{status:200,headers:{Allow:"GET, POST, OPTIONS","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let f=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/newsletter/articles/route",pathname:"/api/admin/newsletter/articles",filename:"route",bundlePath:"app/api/admin/newsletter/articles/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/admin/newsletter/articles/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:w,workUnitAsyncStorage:y,serverHooks:x}=f;function b(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:y})}},79428:e=>{e.exports=require("buffer")},79748:e=>{e.exports=require("fs/promises")},94735:e=>{e.exports=require("events")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,3205,4659,1220,6321,818],()=>r(77586));module.exports=a})();