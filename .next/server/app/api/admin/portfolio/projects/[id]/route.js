"use strict";(()=>{var e={};e.id=8335,e.ids=[8335],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45619:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>N,routeModule:()=>m,serverHooks:()=>_,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{DELETE:()=>f,GET:()=>l,OPTIONS:()=>j,PUT:()=>g});var o=r(96559),a=r(48088),i=r(37719),d=r(32190),n=r(66321),u=r(70818),c=r(31075);let p="dynamic-content/portfolio/content.json",l=(0,n.ru)(async(e,t,{params:r})=>{try{let{id:e}=r,t=await u.Yy.readJSON(p,!0),s=t.projects||[],o=t.categories||[],a=s.find(t=>t.id===e);if(!a)return d.NextResponse.json({success:!1,error:"PROJECT_NOT_FOUND",message:"Project not found."},{status:404});let i=o.find(e=>e.id===a.category),n={...a,category_info:i?{id:i.id,name:i.name,slug:i.slug,color:i.color,icon:i.icon}:null},c=s.filter(t=>t.category===a.category&&t.id!==e).slice(0,5).map(e=>({id:e.id,title:e.title,slug:e.slug,featured_image:e.featured_image,status:e.status}));return d.NextResponse.json({success:!0,data:{project:n,related_projects:c,category:i||null}})}catch(e){return await c.vF.error("portfolio-api",`Failed to get project: ${r.id}`,e,{userId:t.user.id}),d.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to retrieve project."},{status:500})}},(0,n.PS)("portfolio","read")()),g=(0,n.ru)(async(e,t,{params:r})=>{try{let{id:s}=r,{title:o,slug:a,description:i,category:n,status:l,featured:g,featured_image:f,gallery:j,client:m,location:y,start_date:x,end_date:_,investment:N,area:v,tags:w,order:R,metadata:O}=await e.json();if(!o||!n)return d.NextResponse.json({success:!1,error:"INVALID_INPUT",message:"Title and category are required."},{status:400});let I=await u.Yy.readJSON(p,!0),S=I.projects||[],T=I.categories||[],P=S.findIndex(e=>e.id===s);if(-1===P)return d.NextResponse.json({success:!1,error:"PROJECT_NOT_FOUND",message:"Project not found."},{status:404});let E=S[P];if(!T.find(e=>e.id===n))return d.NextResponse.json({success:!1,error:"INVALID_CATEGORY",message:"The specified category does not exist."},{status:400});if(a&&a!==E.slug&&S.find(e=>e.slug===a&&e.id!==s))return d.NextResponse.json({success:!1,error:"SLUG_EXISTS",message:"A project with this slug already exists."},{status:409});let h={...E,title:o,slug:a||E.slug,description:void 0!==i?i:E.description,category:n,status:void 0!==l?l:E.status,featured:void 0!==g?!!g:E.featured,featured_image:void 0!==f?f:E.featured_image,gallery:void 0!==j?Array.isArray(j)?j:[]:E.gallery,client:void 0!==m?m:E.client,location:void 0!==y?y:E.location,start_date:void 0!==x?x:E.start_date,end_date:void 0!==_?_:E.end_date,investment:void 0!==N?N:E.investment,area:void 0!==v?v:E.area,tags:void 0!==w?Array.isArray(w)?w:[]:E.tags,order:void 0!==R?Number(R):E.order,metadata:{...E.metadata,...O||{}},updated_at:new Date().toISOString(),updated_by:t.user.id};if(S[P]=h,E.category!==n){let e=T.findIndex(e=>e.id===E.category);-1!==e&&(T[e].projects_count=Math.max(0,(T[e].projects_count||1)-1),T[e].updated_at=new Date().toISOString(),T[e].updated_by=t.user.id);let r=T.findIndex(e=>e.id===n);-1!==r&&(T[r].projects_count=(T[r].projects_count||0)+1,T[r].updated_at=new Date().toISOString(),T[r].updated_by=t.user.id)}let A={...I,projects:S,categories:T,metadata:{...I.metadata,updated_at:new Date().toISOString(),updated_by:t.user.id}};return await u.Yy.writeJSON(p,A,{validate:!0,backup:!0}),await c.vF.audit({action:"update",resource:"portfolio-project",resourceId:s,message:`Portfolio project '${o}' updated`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{title:o,slug:h.slug,category:n,category_changed:E.category!==n}}),d.NextResponse.json({success:!0,message:"Project updated successfully.",data:{project:h}})}catch(e){return await c.vF.error("portfolio-api",`Failed to update project: ${r.id}`,e,{userId:t.user.id}),d.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to update project."},{status:500})}},(0,n.PS)("portfolio","write")()),f=(0,n.ru)(async(e,t,{params:r})=>{try{let{id:s}=r,o=await u.Yy.readJSON(p,!0),a=o.projects||[],i=o.categories||[],n=a.findIndex(e=>e.id===s);if(-1===n)return d.NextResponse.json({success:!1,error:"PROJECT_NOT_FOUND",message:"Project not found."},{status:404});let l=a[n];a.splice(n,1);let g=i.findIndex(e=>e.id===l.category);-1!==g&&(i[g].projects_count=Math.max(0,(i[g].projects_count||1)-1),i[g].updated_at=new Date().toISOString(),i[g].updated_by=t.user.id);let f={...o,projects:a,categories:i,metadata:{...o.metadata,updated_at:new Date().toISOString(),updated_by:t.user.id}};return await u.Yy.writeJSON(p,f,{validate:!0,backup:!0}),await c.vF.audit({action:"delete",resource:"portfolio-project",resourceId:s,message:`Portfolio project '${l.title}' deleted`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{title:l.title,slug:l.slug,category:l.category}}),d.NextResponse.json({success:!0,message:"Project deleted successfully."})}catch(e){return await c.vF.error("portfolio-api",`Failed to delete project: ${r.id}`,e,{userId:t.user.id}),d.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to delete project."},{status:500})}},(0,n.PS)("portfolio","delete")());async function j(){return new d.NextResponse(null,{status:200,headers:{Allow:"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Methods":"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let m=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/portfolio/projects/[id]/route",pathname:"/api/admin/portfolio/projects/[id]",filename:"route",bundlePath:"app/api/admin/portfolio/projects/[id]/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/admin/portfolio/projects/[id]/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:x,serverHooks:_}=m;function N(){return(0,i.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:x})}},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{e.exports=require("buffer")},79748:e=>{e.exports=require("fs/promises")},94735:e=>{e.exports=require("events")}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,3205,4659,1220,6321,818],()=>r(45619));module.exports=s})();