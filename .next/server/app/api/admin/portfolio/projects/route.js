"use strict";(()=>{var e={};e.id=7059,e.ids=[7059],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68991:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>N,routeModule:()=>h,serverHooks:()=>v,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{GET:()=>j,OPTIONS:()=>w,POST:()=>x});var o=r(96559),a=r(48088),i=r(37719),n=r(32190),c=r(66321),u=r(79748),d=r.n(u),l=r(33873),p=r.n(l),g=r(55511),f=r.n(g);let m=p().join(process.cwd(),"public/json/dynamic-content/portfolio/content.json");async function y(){try{let e=await d().readFile(m,"utf-8");return JSON.parse(e)}catch(e){return console.error("Error reading portfolio file:",e),{projects:[],categories:[]}}}let j=(0,c.ru)(async(e,t)=>{try{let{searchParams:t}=new URL(e.url),r={page:t.get("page")?parseInt(t.get("page")):1,limit:t.get("limit")?parseInt(t.get("limit")):20,sort:t.get("sort")||"created_at",order:t.get("order")||"desc",search:t.get("search")||void 0,category:t.get("category")||void 0,status:t.get("status")||void 0,featured:t.get("featured")||void 0},s=await y(),o=s.projects||[],a=s.categories||[];if(r.search){let e=r.search.toLowerCase();o=o.filter(t=>t.title?.toLowerCase().includes(e)||t.description?.toLowerCase().includes(e)||t.location?.toLowerCase().includes(e)||t.client?.toLowerCase().includes(e)||t.tags?.some(t=>t.toLowerCase().includes(e)))}if(r.category&&(o=o.filter(e=>e.category===r.category)),r.status&&(o=o.filter(e=>e.status===r.status)),void 0!==r.featured){let e="true"===r.featured;o=o.filter(t=>!!t.featured===e)}o.sort((e,t)=>{let s=e[r.sort],o=t[r.sort];if(("created_at"===r.sort||"updated_at"===r.sort)&&(s=new Date(s||0).getTime(),o=new Date(o||0).getTime()),"number"==typeof s&&"number"==typeof o)return"desc"===r.order?o-s:s-o;let a=String(s||"").localeCompare(String(o||""));return"desc"===r.order?-a:a});let i=o.length,c=Math.ceil(i/r.limit),u=(r.page-1)*r.limit,d=o.slice(u,u+r.limit).map(e=>{let t=a.find(t=>t.id===e.category);return{...e,category_info:t?{id:t.id,name:t.name,slug:t.slug,color:t.color}:null}});return n.NextResponse.json({success:!0,data:{projects:d,pagination:{page:r.page,limit:r.limit,total:i,totalPages:c,hasNextPage:r.page<c,hasPrevPage:r.page>1},filters:{search:r.search,category:r.category,status:r.status,featured:r.featured,sort:r.sort,order:r.order},categories:a.map(e=>({id:e.id,name:e.name,slug:e.slug,projects_count:o.filter(t=>t.category===e.id).length}))}})}catch(e){return console.error("portfolio-api","Failed to list projects",e),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to retrieve projects."},{status:500})}},(0,c.PS)("portfolio","read")()),x=(0,c.ru)(async(e,t)=>{try{let{title:r,slug:s,description:o,category:a,status:i="draft",featured:c=!1,featured_image:u,gallery:l=[],client:p,location:g,start_date:j,end_date:x,investment:w,area:h,tags:S=[],order:_,metadata:v={}}=await e.json();if(!r||!a)return n.NextResponse.json({success:!1,error:"INVALID_INPUT",message:"Title and category are required."},{status:400});let N=await y(),R=N.projects||[],A=N.categories||[];if(!A.find(e=>e.id===a))return n.NextResponse.json({success:!1,error:"INVALID_CATEGORY",message:"The specified category does not exist."},{status:400});let O=s||r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");if(R.some(e=>e.slug===O))return n.NextResponse.json({success:!1,error:"SLUG_EXISTS",message:"A project with this slug already exists."},{status:409});let T={id:`proj_${f().randomBytes(8).toString("hex")}`,title:r,slug:O,description:o||"",category:a,status:i,featured:!!c,featured_image:u||"",gallery:Array.isArray(l)?l:[],client:p||"",location:g||"",start_date:j||null,end_date:x||null,investment:w||"",area:h||"",tags:Array.isArray(S)?S:[],order:void 0!==_?Number(_):R.length,metadata:{...v,views:0,likes:0},created_at:new Date().toISOString(),created_by:t.user.id,updated_at:new Date().toISOString(),updated_by:t.user.id};R.push(T);let P=A.findIndex(e=>e.id===a);-1!==P&&(A[P].projects_count=(A[P].projects_count||0)+1,A[P].updated_at=new Date().toISOString(),A[P].updated_by=t.user.id);let I={...N,projects:R,categories:A,metadata:{...N.metadata,updated_at:new Date().toISOString(),updated_by:t.user.id}};return await d().writeFile(m,JSON.stringify(I,null,2),"utf-8"),console.log(`Portfolio project '${r}' created by user ${t.user.id}`),n.NextResponse.json({success:!0,message:"Project created successfully.",data:{project:T}},{status:201})}catch(e){return console.error("portfolio-api","Failed to create project",e),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to create project."},{status:500})}},(0,c.PS)("portfolio","write")());async function w(){return new n.NextResponse(null,{status:200,headers:{Allow:"GET, POST, OPTIONS","Access-Control-Allow-Methods":"GET, POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let h=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/portfolio/projects/route",pathname:"/api/admin/portfolio/projects",filename:"route",bundlePath:"app/api/admin/portfolio/projects/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/admin/portfolio/projects/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:S,workUnitAsyncStorage:_,serverHooks:v}=h;function N(){return(0,i.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:_})}},79428:e=>{e.exports=require("buffer")},79748:e=>{e.exports=require("fs/promises")},94735:e=>{e.exports=require("events")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,3205,1220,6321],()=>r(68991));module.exports=s})();