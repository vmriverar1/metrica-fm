"use strict";(()=>{var e={};e.id=6745,e.ids=[6745],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{e.exports=require("buffer")},79748:e=>{e.exports=require("fs/promises")},94735:e=>{e.exports=require("events")},96102:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>m,serverHooks:()=>R,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>N});var s={};r.r(s),r.d(s,{DELETE:()=>f,GET:()=>l,OPTIONS:()=>y,PUT:()=>g});var a=r(96559),o=r(48088),i=r(37719),n=r(32190),d=r(66321),u=r(70818),c=r(31075);let p="dynamic-content/portfolio/content.json",l=(0,d.ru)(async(e,t,{params:r})=>{try{let{id:e}=r,t=await u.Yy.readJSON(p,!0),s=(t.categories||[]).find(t=>t.id===e);if(!s)return n.NextResponse.json({success:!1,error:"CATEGORY_NOT_FOUND",message:"Category not found."},{status:404});let a=(t.projects||[]).filter(t=>t.category===e);return n.NextResponse.json({success:!0,data:{category:{...s,projects_count:a.length},related_projects:a.map(e=>({id:e.id,title:e.title,status:e.status,featured_image:e.featured_image}))}})}catch(e){return await c.vF.error("portfolio-api",`Failed to get category: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to retrieve category."},{status:500})}},(0,d.PS)("portfolio","read")()),g=(0,d.ru)(async(e,t,{params:r})=>{try{let{id:s}=r,{name:a,slug:o,description:i,icon:d,color:l,featured_image:g,featured:f,order:y}=await e.json();if(!a||!o)return n.NextResponse.json({success:!1,error:"INVALID_INPUT",message:"Name and slug are required."},{status:400});if(!/^[a-z0-9-]+$/.test(o))return n.NextResponse.json({success:!1,error:"INVALID_SLUG",message:"Slug must contain only lowercase letters, numbers, and hyphens."},{status:400});let m=await u.Yy.readJSON(p,!0),x=m.categories||[],N=x.findIndex(e=>e.id===s);if(-1===N)return n.NextResponse.json({success:!1,error:"CATEGORY_NOT_FOUND",message:"Category not found."},{status:404});if(x.find(e=>e.slug===o&&e.id!==s))return n.NextResponse.json({success:!1,error:"SLUG_EXISTS",message:"A category with this slug already exists."},{status:409});let R={...x[N],name:a,slug:o,description:i||"",icon:d||"",color:l||"#E84E0F",featured_image:g||"",featured:!!f,order:void 0!==y?Number(y):x[N].order,updated_at:new Date().toISOString(),updated_by:t.user.id};x[N]=R;let w={...m,categories:x,metadata:{...m.metadata,updated_at:new Date().toISOString(),updated_by:t.user.id}};return await u.Yy.writeJSON(p,w,{validate:!0,backup:!0}),await c.vF.audit({action:"update",resource:"portfolio-category",resourceId:s,message:`Portfolio category '${a}' updated`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{name:a,slug:o}}),n.NextResponse.json({success:!0,message:"Category updated successfully.",data:{category:R}})}catch(e){return await c.vF.error("portfolio-api",`Failed to update category: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to update category."},{status:500})}},(0,d.PS)("portfolio","write")()),f=(0,d.ru)(async(e,t,{params:r})=>{try{let{id:s}=r,a=await u.Yy.readJSON(p,!0),o=a.categories||[],i=a.projects||[],d=o.findIndex(e=>e.id===s);if(-1===d)return n.NextResponse.json({success:!1,error:"CATEGORY_NOT_FOUND",message:"Category not found."},{status:404});let l=o[d],g=i.filter(e=>e.category===s);if(g.length>0)return n.NextResponse.json({success:!1,error:"CATEGORY_HAS_PROJECTS",message:`Cannot delete category with ${g.length} associated projects.`,details:{projects_count:g.length,project_titles:g.slice(0,5).map(e=>e.title)}},{status:409});o.splice(d,1);let f={...a,categories:o,metadata:{...a.metadata,updated_at:new Date().toISOString(),updated_by:t.user.id}};return await u.Yy.writeJSON(p,f,{validate:!0,backup:!0}),await c.vF.audit({action:"delete",resource:"portfolio-category",resourceId:s,message:`Portfolio category '${l.name}' deleted`,user:t.user.id,ip_address:e.headers.get("x-forwarded-for")||"unknown",metadata:{name:l.name,slug:l.slug}}),n.NextResponse.json({success:!0,message:"Category deleted successfully."})}catch(e){return await c.vF.error("portfolio-api",`Failed to delete category: ${r.id}`,e,{userId:t.user.id}),n.NextResponse.json({success:!1,error:"INTERNAL_ERROR",message:"Failed to delete category."},{status:500})}},(0,d.PS)("portfolio","delete")());async function y(){return new n.NextResponse(null,{status:200,headers:{Allow:"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Methods":"GET, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let m=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/admin/portfolio/categories/[id]/route",pathname:"/api/admin/portfolio/categories/[id]",filename:"route",bundlePath:"app/api/admin/portfolio/categories/[id]/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/admin/portfolio/categories/[id]/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:N,serverHooks:R}=m;function w(){return(0,i.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:N})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,580,3205,4659,1220,6321,818],()=>r(96102));module.exports=s})();