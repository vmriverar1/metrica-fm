(()=>{var e={};e.id=179,e.ids=[179],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14510:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>v,routeModule:()=>f,serverHooks:()=>y,workAsyncStorage:()=>A,workUnitAsyncStorage:()=>w});var r={};s.r(r),s.d(r,{GET:()=>d,OPTIONS:()=>h,PATCH:()=>g,POST:()=>m});var a=s(96559),i=s(48088),n=s(37719),o=s(32190),c=s(91086);class u{static{this.cache=new Map}static async getApplications(e={}){return this.getApplicationsFromLocal(e)}static getApplicationsFromLocal(e){let t=[...c.Ws];if(e.status&&e.status.length>0&&(t=t.filter(t=>e.status.includes(t.status))),e.jobId&&(t=t.filter(t=>t.jobId===e.jobId)),e.assignedTo&&(t=t.filter(t=>t.assignedRecruiter===e.assignedTo)),e.searchQuery){let s=e.searchQuery.toLowerCase();t=t.filter(e=>e.applicantName.toLowerCase().includes(s)||e.applicantEmail.toLowerCase().includes(s)||e.coverletter?.toLowerCase().includes(s))}return e.priority&&(t=t.filter(t=>t.priority===e.priority)),e.source&&(t=t.filter(t=>t.source===e.source)),t.sort((e,t)=>t.submittedAt.getTime()-e.submittedAt.getTime()),e.offset&&(t=t.slice(e.offset)),e.limit&&(t=t.slice(0,e.limit)),t}static async getApplicationById(e){return c.Ws.find(t=>t.id===e)||null}static async updateApplicationStatus(e,t,s,r){let a=c.Ws.find(t=>t.id===e);if(a){a.status=t,a.lastActivity=new Date;let i={id:Date.now().toString(),type:"status_change",description:`Status changed to ${t}`,performedBy:s,performedAt:new Date,metadata:{newStatus:t,notes:r}};return a.activities||(a.activities=[]),a.activities.push(i),console.log(`Application ${e} status updated to ${t}`),!0}return!1}static async getRecruitmentStats(){let e=c.Ws,t=e.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{}),s=e.reduce((e,t)=>(e[t.source]=(e[t.source]||0)+1,e),{}),r=new Date,a=e.filter(e=>e.submittedAt.getMonth()===r.getMonth()&&e.submittedAt.getFullYear()===r.getFullYear());return{totalApplications:e.length,pendingReview:t.pending||0,inReview:t.reviewing||0,interviewed:t.interviewed||0,hired:t.hired||0,rejected:t.rejected||0,avgTimeToHire:21,conversionRate:(t.hired||0)/e.length*100,topSources:Object.entries(s).sort(([,e],[,t])=>t-e).slice(0,3).map(([e,t])=>({source:e,count:t})),monthlyApplications:a.length,trending:{applicationsChange:12,conversionChange:3,timeToHireChange:-2}}}static async getRecruiters(){return c.dK}static async getSystemInfo(){return{directusAvailable:!1,dataSource:"local",apiEndpoint:"local-data",lastCheck:new Date,totalApplications:c.Ws.length,version:"1.0.0"}}static async searchApplications(e){return this.getApplications({searchQuery:e})}static async getApplicationsByJob(e){return this.getApplications({jobId:e})}static async getApplicationsByStatus(e){return this.getApplications({status:e})}static clearCache(){this.cache.clear()}}var l=s(66083);async function p(e){let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return null;t.split(" ")[1];let s=l.u.getCurrentUser();return s||null}async function d(e){try{if(!await p(e))return o.NextResponse.json({success:!1,error:"Token de autorizaci\xf3n requerido",code:"UNAUTHORIZED"},{status:401});if(!l.u.canAccess("applications","read"))return o.NextResponse.json({success:!1,error:"No tienes permisos para ver aplicaciones",code:"FORBIDDEN"},{status:403});let{searchParams:t}=new URL(e.url),s={},r=t.get("status");r&&(s.status=r.split(","));let a=t.get("priority");a&&(s.priority=a.split(","));let i=t.get("source");i&&(s.source=i.split(","));let n=t.get("jobId");n&&(s.jobId=n);let c=t.get("fromDate"),d=t.get("toDate");c&&d&&(s.dateRange={from:new Date(c),to:new Date(d)});let m=t.get("minScore"),g=t.get("maxScore");m&&g&&(s.score={min:parseInt(m),max:parseInt(g)});let h=t.get("search");h&&(s.searchQuery=h);let f=t.get("flagged");f&&(s.flagged="true"===f);let A=t.get("assignedTo");A&&(s.assignedTo=A);let w=t.get("limit"),y=t.get("offset");w&&(s.limit=parseInt(w)),y&&(s.offset=parseInt(y));let v=await u.getApplications(s);return o.NextResponse.json({success:!0,data:v,meta:{total:v.length,limit:s.limit||v.length,offset:s.offset||0,hasMore:v.length===(s.limit||0)},filters:s})}catch(e){return console.error("API Applications GET Error:",e),o.NextResponse.json({success:!1,error:"Error interno del servidor",code:"INTERNAL_ERROR"},{status:500})}}async function m(e){try{if(!await p(e))return o.NextResponse.json({success:!1,error:"Token de autorizaci\xf3n requerido",code:"UNAUTHORIZED"},{status:401});if(!l.u.canAccess("applications","create"))return o.NextResponse.json({success:!1,error:"No tienes permisos para crear aplicaciones",code:"FORBIDDEN"},{status:403});let t=await e.json(),s=["jobId","candidateInfo","source"].filter(e=>!t[e]);if(s.length>0)return o.NextResponse.json({success:!1,error:`Campos requeridos faltantes: ${s.join(", ")}`,code:"MISSING_FIELDS"},{status:400});let r=["firstName","lastName","email","phone"].filter(e=>!t.candidateInfo[e]);if(r.length>0)return o.NextResponse.json({success:!1,error:`Campos de candidato requeridos: ${r.join(", ")}`,code:"MISSING_CANDIDATE_FIELDS"},{status:400});let a={id:`app-${Date.now()}`,jobId:t.jobId,jobTitle:t.jobTitle||"Posici\xf3n Externa",candidateInfo:{...t.candidateInfo,location:t.candidateInfo.location||{city:"Lima",country:"Per\xfa"},availability:t.candidateInfo.availability||{startDate:new Date,noticePeriod:30}},documents:t.documents||[],responses:t.responses||[],status:"submitted",priority:t.priority||"normal",source:t.source,submittedAt:new Date,tags:t.tags||[],flagged:!1,activities:[{id:`act-${Date.now()}`,type:"status-change",description:"Aplicaci\xf3n creada via API",performedBy:"API System",performedAt:new Date}],interviews:[],internalNotes:[],viewCount:0,timeInStage:0};return console.log("\uD83D\uDCDD Nueva aplicaci\xf3n creada via API:",a.id),o.NextResponse.json({success:!0,data:a,message:"Aplicaci\xf3n creada exitosamente"},{status:201})}catch(e){return console.error("API Applications POST Error:",e),o.NextResponse.json({success:!1,error:"Error interno del servidor",code:"INTERNAL_ERROR"},{status:500})}}async function g(e){try{let t=await p(e);if(!t)return o.NextResponse.json({success:!1,error:"Token de autorizaci\xf3n requerido",code:"UNAUTHORIZED"},{status:401});if(!l.u.canAccess("applications","update"))return o.NextResponse.json({success:!1,error:"No tienes permisos para actualizar aplicaciones",code:"FORBIDDEN"},{status:403});let{id:s,status:r,priority:a,assignedTo:i,notes:n}=await e.json();if(!s)return o.NextResponse.json({success:!1,error:"ID de aplicaci\xf3n requerido",code:"MISSING_ID"},{status:400});let c=!1;if(r&&(c=await u.updateApplicationStatus(s,r,t.firstName+" "+t.lastName,n)),c)return o.NextResponse.json({success:!0,message:"Aplicaci\xf3n actualizada exitosamente"});return o.NextResponse.json({success:!1,error:"No se pudo actualizar la aplicaci\xf3n",code:"UPDATE_FAILED"},{status:400})}catch(e){return console.error("API Applications PATCH Error:",e),o.NextResponse.json({success:!1,error:"Error interno del servidor",code:"INTERNAL_ERROR"},{status:500})}}async function h(){return new o.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PATCH, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let f=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/applications/route",pathname:"/api/applications",filename:"route",bundlePath:"app/api/applications/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/applications/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:A,workUnitAsyncStorage:w,serverHooks:y}=f;function v(){return(0,n.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:w})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66083:(e,t,s)=>{"use strict";s.d(t,{u:()=>o});let r=new Map,a=[],i=[{id:"super-admin",name:"Super Administrador",description:"Acceso completo al sistema",level:1,isSystem:!0,permissions:[{id:"1",name:"all",resource:"*",action:"*"}]},{id:"hr-manager",name:"Gerente de RRHH",description:"Gesti\xf3n completa de reclutamiento",level:2,isSystem:!0,permissions:[{id:"2",name:"manage-applications",resource:"applications",action:"*"},{id:"3",name:"manage-jobs",resource:"jobs",action:"*"},{id:"4",name:"view-reports",resource:"reports",action:"read"},{id:"5",name:"manage-recruiters",resource:"users",action:"read,update"}]},{id:"recruiter",name:"Reclutador",description:"Gesti\xf3n de aplicaciones asignadas",level:3,isSystem:!0,permissions:[{id:"6",name:"view-applications",resource:"applications",action:"read,update",conditions:{assignedTo:"self"}},{id:"7",name:"view-jobs",resource:"jobs",action:"read"},{id:"8",name:"basic-reports",resource:"reports",action:"read",conditions:{scope:"own"}}]},{id:"hiring-manager",name:"Gerente de Contrataci\xf3n",description:"Aprobaci\xf3n y toma de decisiones",level:2,isSystem:!0,permissions:[{id:"9",name:"approve-applications",resource:"applications",action:"read,update,approve"},{id:"10",name:"manage-department-jobs",resource:"jobs",action:"*",conditions:{department:"own"}},{id:"11",name:"department-reports",resource:"reports",action:"read",conditions:{scope:"department"}}]},{id:"viewer",name:"Visualizador",description:"Solo lectura de informaci\xf3n b\xe1sica",level:4,isSystem:!0,permissions:[{id:"12",name:"view-basic-info",resource:"applications",action:"read",conditions:{fields:["basic"]}},{id:"13",name:"view-public-jobs",resource:"jobs",action:"read",conditions:{status:"public"}}]}],n=[{id:"user-001",email:"admin@metrica-dip.com",firstName:"Carlos",lastName:"Mendoza",role:i[0],department:"Direcci\xf3n General",permissions:i[0].permissions,isActive:!0,lastLogin:new Date,createdAt:new Date("2024-01-15"),updatedAt:new Date,twoFactorEnabled:!0,preferences:{theme:"system",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!0,desktop:!0,types:{newApplication:!0,statusChange:!0,systemUpdates:!0,reports:!0}},dashboard:{layout:"comfortable",widgets:["stats","recent-applications","pending-approvals","system-health"],autoRefresh:!0,refreshInterval:3e4}}},{id:"user-002",email:"ana.torres@metrica-dip.com",firstName:"Ana",lastName:"Torres",role:i[2],department:"Recursos Humanos",permissions:i[2].permissions,isActive:!0,lastLogin:new Date(Date.now()-72e5),createdAt:new Date("2024-02-01"),updatedAt:new Date,twoFactorEnabled:!1,preferences:{theme:"light",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!0,desktop:!1,types:{newApplication:!0,statusChange:!0,systemUpdates:!1,reports:!1}},dashboard:{layout:"compact",widgets:["my-applications","recent-activity","quick-actions"],autoRefresh:!0,refreshInterval:6e4}}},{id:"user-003",email:"luis.hernandez@metrica-dip.com",firstName:"Luis",lastName:"Hern\xe1ndez",role:i[3],department:"Arquitectura y Dise\xf1o",permissions:i[3].permissions,isActive:!0,lastLogin:new Date(Date.now()-864e5),createdAt:new Date("2024-01-20"),updatedAt:new Date,twoFactorEnabled:!0,preferences:{theme:"dark",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!1,desktop:!0,types:{newApplication:!0,statusChange:!0,systemUpdates:!0,reports:!0}},dashboard:{layout:"spacious",widgets:["department-overview","pending-approvals","team-performance"],autoRefresh:!1,refreshInterval:3e5}}}];class o{static{this.currentUser=null}static{this.currentSession=null}static async login(e){let{email:t,password:s,rememberMe:r,twoFactorCode:i}=e,o={id:`attempt-${Date.now()}`,email:t,ipAddress:"127.0.0.1",userAgent:"Server",success:!1,timestamp:new Date};try{let e=n.find(e=>e.email===t&&e.isActive);if(!e)return o.failureReason="Usuario no encontrado",a.push(o),{success:!1,error:"Credenciales inv\xe1lidas"};if("admin123"!==s)return o.failureReason="Password incorrecto",a.push(o),{success:!1,error:"Credenciales inv\xe1lidas"};if(e.twoFactorEnabled&&!i)return{success:!1,requiresTwoFactor:!0,error:"C\xf3digo de verificaci\xf3n requerido"};if(e.twoFactorEnabled&&i&&!this.verify2FA(e,i))return o.failureReason="C\xf3digo 2FA inv\xe1lido",a.push(o),{success:!1,error:"C\xf3digo de verificaci\xf3n inv\xe1lido"};let c=await this.createSession(e,r);return e.lastLogin=new Date,o.success=!0,a.push(o),this.currentUser=e,this.currentSession=c,console.log("\uD83D\uDD10 Usuario autenticado:",e.email,e.role.name),{success:!0,session:c}}catch(e){return o.failureReason="Error del sistema",a.push(o),{success:!1,error:e instanceof Error?e.message:"Error interno del sistema"}}}static async logout(){this.currentSession&&(r.delete(this.currentSession.accessToken),this.currentSession=null,this.currentUser=null),console.log("\uD83D\uDC4B Usuario desconectado")}static getCurrentUser(){return this.currentUser}static getCurrentSession(){return this.currentSession}static hasPermission(e,t){let s=t||this.currentUser;return!!s&&("Super Administrador"===s.role.name||s.permissions.some(t=>"*"===t.resource&&"*"===t.action||t.resource===e.resource&&"*"===t.action||"*"===t.resource&&t.action===e.action||t.resource===e.resource&&t.action===e.action||!!(t.resource===e.resource&&t.action.includes(","))&&t.action.split(",").includes(e.action)))}static canAccess(e,t="read"){return this.hasPermission({resource:e,action:t})}static getRoles(){return i}static async getUsers(){if(!this.canAccess("users","read"))throw Error("No tienes permisos para ver usuarios");return n}static async createUser(e){if(!this.canAccess("users","create"))throw Error("No tienes permisos para crear usuarios");let t={id:`user-${Date.now()}`,email:e.email||"",firstName:e.firstName||"",lastName:e.lastName||"",role:e.role||i[4],department:e.department||"",permissions:e.role?.permissions||[],isActive:e.isActive??!0,lastLogin:new Date,createdAt:new Date,updatedAt:new Date,twoFactorEnabled:!1,preferences:{theme:"system",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!1,desktop:!1,types:{newApplication:!0,statusChange:!0,systemUpdates:!1,reports:!1}},dashboard:{layout:"comfortable",widgets:["recent-activity"],autoRefresh:!1,refreshInterval:6e4}}};return n.push(t),t}static async updateUser(e,t){if(!this.canAccess("users","update"))throw Error("No tienes permisos para actualizar usuarios");let s=n.findIndex(t=>t.id===e);if(-1===s)throw Error("Usuario no encontrado");return n[s]={...n[s],...t,updatedAt:new Date},n[s]}static getLoginAttempts(){if(!this.canAccess("system","read"))throw Error("No tienes permisos para ver logs de sistema");return a}static async refreshToken(){if(!this.currentSession||!this.currentUser)return null;if(new Date>=this.currentSession.expiresAt)return await this.logout(),null;let e=await this.createSession(this.currentUser,!0);return this.currentSession=e,e}static async initializeFromStorage(){return!1}static async createSession(e,t=!1){let s=this.generateToken(),a={user:e,accessToken:s,refreshToken:this.generateToken(),expiresAt:new Date(Date.now()+(t?2592e6:288e5)),permissions:e.permissions};return r.set(s,a),a}static generateToken(){return`tok_${Date.now()}_${Math.random().toString(36).substring(2)}`}static verify2FA(e,t){return"123456"===t}static async devAutoLogin(e="admin@metrica-dip.com"){return!1}}},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4447,580,1086],()=>s(14510));module.exports=r})();