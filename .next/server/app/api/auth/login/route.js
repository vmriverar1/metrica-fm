(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},38042:(e,s,r)=>{"use strict";r.r(s),r.d(s,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>h,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var t={};r.r(t),r.d(t,{OPTIONS:()=>d,POST:()=>u});var i=r(96559),a=r(48088),n=r(37719),o=r(32190),c=r(66083);async function u(e){try{let{email:s,password:r,twoFactorCode:t,rememberMe:i}=await e.json();if(!s||!r)return o.NextResponse.json({success:!1,error:"Email y password son requeridos",code:"MISSING_CREDENTIALS"},{status:400});let a=await c.u.login({email:s,password:r,twoFactorCode:t,rememberMe:i});if(a.success&&a.session)return o.NextResponse.json({success:!0,data:{user:{id:a.session.user.id,email:a.session.user.email,firstName:a.session.user.firstName,lastName:a.session.user.lastName,role:a.session.user.role.name,department:a.session.user.department,permissions:a.session.user.permissions.map(e=>({resource:e.resource,action:e.action}))},session:{accessToken:a.session.accessToken,expiresAt:a.session.expiresAt.toISOString()}},message:"Autenticaci\xf3n exitosa"});if(a.requiresTwoFactor)return o.NextResponse.json({success:!1,requiresTwoFactor:!0,message:"C\xf3digo de verificaci\xf3n 2FA requerido",code:"REQUIRES_2FA"},{status:202});return o.NextResponse.json({success:!1,error:a.error||"Credenciales inv\xe1lidas",code:"INVALID_CREDENTIALS"},{status:401})}catch(e){return console.error("API Login Error:",e),o.NextResponse.json({success:!1,error:"Error interno del servidor",code:"INTERNAL_ERROR"},{status:500})}}async function d(){return new o.NextResponse(null,{status:200,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization"}})}let p=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/root/proyectos/freelos/metrica/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:h}=p;function g(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66083:(e,s,r)=>{"use strict";r.d(s,{u:()=>o});let t=new Map,i=[],a=[{id:"super-admin",name:"Super Administrador",description:"Acceso completo al sistema",level:1,isSystem:!0,permissions:[{id:"1",name:"all",resource:"*",action:"*"}]},{id:"hr-manager",name:"Gerente de RRHH",description:"Gesti\xf3n completa de reclutamiento",level:2,isSystem:!0,permissions:[{id:"2",name:"manage-applications",resource:"applications",action:"*"},{id:"3",name:"manage-jobs",resource:"jobs",action:"*"},{id:"4",name:"view-reports",resource:"reports",action:"read"},{id:"5",name:"manage-recruiters",resource:"users",action:"read,update"}]},{id:"recruiter",name:"Reclutador",description:"Gesti\xf3n de aplicaciones asignadas",level:3,isSystem:!0,permissions:[{id:"6",name:"view-applications",resource:"applications",action:"read,update",conditions:{assignedTo:"self"}},{id:"7",name:"view-jobs",resource:"jobs",action:"read"},{id:"8",name:"basic-reports",resource:"reports",action:"read",conditions:{scope:"own"}}]},{id:"hiring-manager",name:"Gerente de Contrataci\xf3n",description:"Aprobaci\xf3n y toma de decisiones",level:2,isSystem:!0,permissions:[{id:"9",name:"approve-applications",resource:"applications",action:"read,update,approve"},{id:"10",name:"manage-department-jobs",resource:"jobs",action:"*",conditions:{department:"own"}},{id:"11",name:"department-reports",resource:"reports",action:"read",conditions:{scope:"department"}}]},{id:"viewer",name:"Visualizador",description:"Solo lectura de informaci\xf3n b\xe1sica",level:4,isSystem:!0,permissions:[{id:"12",name:"view-basic-info",resource:"applications",action:"read",conditions:{fields:["basic"]}},{id:"13",name:"view-public-jobs",resource:"jobs",action:"read",conditions:{status:"public"}}]}],n=[{id:"user-001",email:"admin@metrica-dip.com",firstName:"Carlos",lastName:"Mendoza",role:a[0],department:"Direcci\xf3n General",permissions:a[0].permissions,isActive:!0,lastLogin:new Date,createdAt:new Date("2024-01-15"),updatedAt:new Date,twoFactorEnabled:!0,preferences:{theme:"system",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!0,desktop:!0,types:{newApplication:!0,statusChange:!0,systemUpdates:!0,reports:!0}},dashboard:{layout:"comfortable",widgets:["stats","recent-applications","pending-approvals","system-health"],autoRefresh:!0,refreshInterval:3e4}}},{id:"user-002",email:"ana.torres@metrica-dip.com",firstName:"Ana",lastName:"Torres",role:a[2],department:"Recursos Humanos",permissions:a[2].permissions,isActive:!0,lastLogin:new Date(Date.now()-72e5),createdAt:new Date("2024-02-01"),updatedAt:new Date,twoFactorEnabled:!1,preferences:{theme:"light",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!0,desktop:!1,types:{newApplication:!0,statusChange:!0,systemUpdates:!1,reports:!1}},dashboard:{layout:"compact",widgets:["my-applications","recent-activity","quick-actions"],autoRefresh:!0,refreshInterval:6e4}}},{id:"user-003",email:"luis.hernandez@metrica-dip.com",firstName:"Luis",lastName:"Hern\xe1ndez",role:a[3],department:"Arquitectura y Dise\xf1o",permissions:a[3].permissions,isActive:!0,lastLogin:new Date(Date.now()-864e5),createdAt:new Date("2024-01-20"),updatedAt:new Date,twoFactorEnabled:!0,preferences:{theme:"dark",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!1,desktop:!0,types:{newApplication:!0,statusChange:!0,systemUpdates:!0,reports:!0}},dashboard:{layout:"spacious",widgets:["department-overview","pending-approvals","team-performance"],autoRefresh:!1,refreshInterval:3e5}}}];class o{static{this.currentUser=null}static{this.currentSession=null}static async login(e){let{email:s,password:r,rememberMe:t,twoFactorCode:a}=e,o={id:`attempt-${Date.now()}`,email:s,ipAddress:"127.0.0.1",userAgent:"Server",success:!1,timestamp:new Date};try{let e=n.find(e=>e.email===s&&e.isActive);if(!e)return o.failureReason="Usuario no encontrado",i.push(o),{success:!1,error:"Credenciales inv\xe1lidas"};if("admin123"!==r)return o.failureReason="Password incorrecto",i.push(o),{success:!1,error:"Credenciales inv\xe1lidas"};if(e.twoFactorEnabled&&!a)return{success:!1,requiresTwoFactor:!0,error:"C\xf3digo de verificaci\xf3n requerido"};if(e.twoFactorEnabled&&a&&!this.verify2FA(e,a))return o.failureReason="C\xf3digo 2FA inv\xe1lido",i.push(o),{success:!1,error:"C\xf3digo de verificaci\xf3n inv\xe1lido"};let c=await this.createSession(e,t);return e.lastLogin=new Date,o.success=!0,i.push(o),this.currentUser=e,this.currentSession=c,console.log("\uD83D\uDD10 Usuario autenticado:",e.email,e.role.name),{success:!0,session:c}}catch(e){return o.failureReason="Error del sistema",i.push(o),{success:!1,error:e instanceof Error?e.message:"Error interno del sistema"}}}static async logout(){this.currentSession&&(t.delete(this.currentSession.accessToken),this.currentSession=null,this.currentUser=null),console.log("\uD83D\uDC4B Usuario desconectado")}static getCurrentUser(){return this.currentUser}static getCurrentSession(){return this.currentSession}static hasPermission(e,s){let r=s||this.currentUser;return!!r&&("Super Administrador"===r.role.name||r.permissions.some(s=>"*"===s.resource&&"*"===s.action||s.resource===e.resource&&"*"===s.action||"*"===s.resource&&s.action===e.action||s.resource===e.resource&&s.action===e.action||!!(s.resource===e.resource&&s.action.includes(","))&&s.action.split(",").includes(e.action)))}static canAccess(e,s="read"){return this.hasPermission({resource:e,action:s})}static getRoles(){return a}static async getUsers(){if(!this.canAccess("users","read"))throw Error("No tienes permisos para ver usuarios");return n}static async createUser(e){if(!this.canAccess("users","create"))throw Error("No tienes permisos para crear usuarios");let s={id:`user-${Date.now()}`,email:e.email||"",firstName:e.firstName||"",lastName:e.lastName||"",role:e.role||a[4],department:e.department||"",permissions:e.role?.permissions||[],isActive:e.isActive??!0,lastLogin:new Date,createdAt:new Date,updatedAt:new Date,twoFactorEnabled:!1,preferences:{theme:"system",language:"es",timezone:"America/Lima",notifications:{email:!0,push:!1,desktop:!1,types:{newApplication:!0,statusChange:!0,systemUpdates:!1,reports:!1}},dashboard:{layout:"comfortable",widgets:["recent-activity"],autoRefresh:!1,refreshInterval:6e4}}};return n.push(s),s}static async updateUser(e,s){if(!this.canAccess("users","update"))throw Error("No tienes permisos para actualizar usuarios");let r=n.findIndex(s=>s.id===e);if(-1===r)throw Error("Usuario no encontrado");return n[r]={...n[r],...s,updatedAt:new Date},n[r]}static getLoginAttempts(){if(!this.canAccess("system","read"))throw Error("No tienes permisos para ver logs de sistema");return i}static async refreshToken(){if(!this.currentSession||!this.currentUser)return null;if(new Date>=this.currentSession.expiresAt)return await this.logout(),null;let e=await this.createSession(this.currentUser,!0);return this.currentSession=e,e}static async initializeFromStorage(){return!1}static async createSession(e,s=!1){let r=this.generateToken(),i={user:e,accessToken:r,refreshToken:this.generateToken(),expiresAt:new Date(Date.now()+(s?2592e6:288e5)),permissions:e.permissions};return t.set(r,i),i}static generateToken(){return`tok_${Date.now()}_${Math.random().toString(36).substring(2)}`}static verify2FA(e,s){return"123456"===s}static async devAutoLogin(e="admin@metrica-dip.com"){return!1}}},78335:()=>{},96487:()=>{}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[4447,580],()=>r(38042));module.exports=t})();