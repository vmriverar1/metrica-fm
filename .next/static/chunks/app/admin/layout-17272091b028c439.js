(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7581],{11243:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var s=t(95155),a=t(48152);function n(e){let{children:r}=e;return(0,s.jsx)(a.OJ,{children:r})}},48152:(e,r,t)=>{"use strict";t.d(r,{OJ:()=>d,As:()=>m,ru:()=>y});var s=t(95155),a=t(12115);let n={id:"1",email:"admin@metrica.pe",firstName:"Admin",lastName:"Usuario",avatar:"",role:{id:"admin",name:"Administrador",description:"Acceso completo al sistema",level:1,permissions:[{id:"admin-all",name:"Administrar todo",resource:"*",action:"*"}]},department:"Tecnolog\xeda",permissions:[],isActive:!0,lastLogin:new Date,createdAt:new Date,updatedAt:new Date,preferences:{theme:"light",language:"es",timezone:"America/Lima",notifications:{email:!0,browser:!0,digest:"daily"},dashboard:{layout:"default",widgets:[]}},twoFactorEnabled:!1},o={id:"session-1",userId:"1",token:"mock-token",refreshToken:"mock-refresh-token",expiresAt:new Date(Date.now()+864e5),createdAt:new Date,lastActivity:new Date,userAgent:"Mock Browser",ipAddress:"127.0.0.1"};class i{static async login(e){if(await new Promise(e=>setTimeout(e,1e3)),"admin@metrica.pe"===e.email&&"admin123"===e.password)return localStorage.setItem("auth-token","mock-token"),localStorage.setItem("auth-user",JSON.stringify(n)),{user:n,session:o};throw Error("Credenciales inv\xe1lidas")}static async logout(){localStorage.removeItem("auth-token"),localStorage.removeItem("auth-user"),await new Promise(e=>setTimeout(e,500))}static async refreshToken(e){return await new Promise(e=>setTimeout(e,500)),{...o,token:"new-mock-token"}}static async getCurrentUser(){let e=localStorage.getItem("auth-token"),r=localStorage.getItem("auth-user");if("mock-token"===e&&r)try{return JSON.parse(r)}catch(e){}return null}static getCurrentUserSync(){var e,r;let t=null==(e=localStorage)?void 0:e.getItem("auth-token"),s=null==(r=localStorage)?void 0:r.getItem("auth-user");if("mock-token"===t&&s)try{return JSON.parse(s)}catch(e){}return null}static async updateUserPreferences(e,r){return{...n,preferences:{...n.preferences,...r}}}static hasPermission(e,r,t){return 1===e.role.level}static canAccess(e,r,t){return 1===e.role.level}static async initializeFromStorage(){var e;return"mock-token"===(null==(e=localStorage)?void 0:e.getItem("auth-token"))}static getCurrentSession(){var e;return"mock-token"===(null==(e=localStorage)?void 0:e.getItem("auth-token"))?o:null}static getCurrentSessionSync(){var e;return"mock-token"===(null==(e=localStorage)?void 0:e.getItem("auth-token"))?o:null}static async devAutoLogin(){var e;return"mock-token"===(null==(e=localStorage)?void 0:e.getItem("auth-token"))}}let l={user:null,session:null,isAuthenticated:!1,isLoading:!0,error:null,requiresTwoFactor:!1};function c(e,r){switch(r.type){case"LOGIN_START":return{...e,isLoading:!0,error:null,requiresTwoFactor:!1};case"LOGIN_SUCCESS":return{...e,user:r.payload.user,session:r.payload.session,isAuthenticated:!0,isLoading:!1,error:null,requiresTwoFactor:!1};case"LOGIN_ERROR":return{...e,user:null,session:null,isAuthenticated:!1,isLoading:!1,error:r.payload,requiresTwoFactor:!1};case"LOGIN_REQUIRES_2FA":return{...e,isLoading:!1,error:null,requiresTwoFactor:!0};case"LOGOUT":return{...e,user:null,session:null,isAuthenticated:!1,isLoading:!1,error:null,requiresTwoFactor:!1};case"REFRESH_TOKEN":return{...e,session:r.payload,error:null};case"CLEAR_ERROR":return{...e,error:null,requiresTwoFactor:!1};case"SET_LOADING":return{...e,isLoading:r.payload};case"UPDATE_USER":return{...e,user:r.payload};default:return e}}let u=(0,a.createContext)(null);function d(e){let{children:r}=e,[t,n]=(0,a.useReducer)(c,l);(0,a.useEffect)(()=>{(async()=>{n({type:"SET_LOADING",payload:!0});try{if(await i.initializeFromStorage()){let e=await i.getCurrentUser(),r=i.getCurrentSession();e&&r?n({type:"LOGIN_SUCCESS",payload:{user:e,session:r}}):n({type:"LOGOUT"})}else n({type:"LOGOUT"})}catch(e){console.error("Error initializing auth:",e),n({type:"LOGOUT"})}finally{n({type:"SET_LOADING",payload:!1})}})()},[]),(0,a.useEffect)(()=>{if(!t.isAuthenticated||!t.session)return;let e=setInterval(async()=>{try{var e;let r=await i.refreshToken((null==(e=t.session)?void 0:e.refreshToken)||"");r?n({type:"REFRESH_TOKEN",payload:r}):n({type:"LOGOUT"})}catch(e){console.error("Error refreshing token:",e),n({type:"LOGOUT"})}},3e5);return()=>clearInterval(e)},[t.isAuthenticated,t.session]);let o={...t,actions:{async login(e){n({type:"LOGIN_START"});try{let r=await i.login(e);if(r&&r.user&&r.session)return n({type:"LOGIN_SUCCESS",payload:{user:r.user,session:r.session}}),!0;return n({type:"LOGIN_ERROR",payload:"Error de autenticaci\xf3n"}),!1}catch(e){return n({type:"LOGIN_ERROR",payload:e instanceof Error?e.message:"Error interno"}),!1}},async logout(){await i.logout(),n({type:"LOGOUT"})},async refreshToken(){try{var e;let r=await i.refreshToken((null==(e=t.session)?void 0:e.refreshToken)||"");r?n({type:"REFRESH_TOKEN",payload:r}):n({type:"LOGOUT"})}catch(e){console.error("Error refreshing token:",e),n({type:"LOGOUT"})}},clearError(){n({type:"CLEAR_ERROR"})},hasPermission:(e,r)=>i.hasPermission({resource:e,action:r},t.user||void 0),canAccess(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read";return i.canAccess(e,r)},async updateUserPreferences(e){if(t.user)try{let r=await i.updateUser(t.user.id,{preferences:{...t.user.preferences,...e}});n({type:"UPDATE_USER",payload:r})}catch(e){throw console.error("Error updating user preferences:",e),e}}}};return(0,s.jsx)(u.Provider,{value:o,children:r})}function m(){let e=(0,a.useContext)(u);if(!e)throw Error("useAuth debe ser usado dentro de AuthProvider");return e}function y(e){return function(r){let{isAuthenticated:t,isLoading:a}=m();return a?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):t?(0,s.jsx)(e,{...r}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Acceso Requerido"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Debes iniciar sesi\xf3n para acceder a esta p\xe1gina."})]})})}}},78464:(e,r,t)=>{Promise.resolve().then(t.bind(t,11243))}},e=>{var r=r=>e(e.s=r);e.O(0,[8441,1684,7358],()=>r(78464)),_N_E=e.O()}]);